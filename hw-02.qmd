---
title: "HW 02"
author: "Amit Chawla"
format: 
  html:
    embed-resources: true
toc: true
---

### Packages & Setup

```{r}

if(!require(pacman))
  install.packages("pacman")

pacman::p_load(tidyverse,
               here,
               scales,
               ggthemes,
               ggridges,
               dsbox,
               glue,
               fs,
               dplyr,
               gt,
               ggrepel,
               patchwork,
               janitor)

# set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# set width of code output
options(width = 65)

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7,        # 7" width
  fig.asp = 0.618,      # the golden ratio
  fig.retina = 3,       # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300             # higher dpi, sharper image
)
```

## 1 - A new day, a new plot, a new geom

```{r}
#| label: label-me-1

edibnb |>
  glimpse()

# Clean and prepare data
edibnb_clean <- edibnb |>
  filter(!is.na(neighbourhood), !is.na(review_scores_rating))

# Create ordered neighborhood levels by median review score
neighbourhood_order <- edibnb_clean |>
  group_by(neighbourhood) |>
  summarize(median_score = median(review_scores_rating, na.rm = TRUE), .groups = "drop") |>
  arrange(median_score) |>
  pull(neighbourhood)

# Apply ordering to factor
edibnb_clean <- edibnb_clean |>
  mutate(neighbourhood = factor(neighbourhood, levels = neighbourhood_order))

# Plot
ggplot(edibnb_clean, aes(x = review_scores_rating, y = neighbourhood)) +
  geom_density_ridges(scale = 1.2, rel_min_height = 0.01, fill = "#69b3a2", alpha = 0.7) +
  theme_minimal() +
  labs(
    title = "Distribution of Airbnb Review Scores by Edinburgh Neighborhood",
    x = "Review Score Rating",
    y = "Neighborhood"
  )
```

## 2 - Foreign Connected PACs

```{r}
#| label: label-me-2

# get a list of files with "Foreign Connected PAC" in their names
list_of_files <- dir_ls(path = "data", regexp = "Foreign Connected PAC")

# read all files and row bind them
# keeping track of the file name in a new column called year
pac <- read_csv(list_of_files, id = "year")

#pac |>
#  glimpse()

#head(pac)

# Step 3: Clean column names
pac_clean <- pac |> 
  janitor::clean_names()

# Step 4: Extract year from file path string
pac_clean <- pac_clean |> 
  mutate(year = str_extract(year, "\\d{4}"),  # Extracts 4-digit year
         year = as.integer(year))

# Step 5: Separate `country_of_origin_parent_company` into two columns
pac_clean <- pac_clean |> 
  separate(country_of_origin_parent_company, 
           into = c("country", "parent_company"), 
           sep = "/", 
           fill = "right")

# Step 6: Remove `$` and commas, then convert numeric columns
pac_clean <- pac_clean |> 
  mutate(across(c(total, dems, repubs), 
                ~ parse_number(.x)))  # handles $ and commas

# Step 7: Select and rename final columns
pac_final <- pac_clean |> 
  select(year,
         pac_name_affiliate,
         country,
         parent_company,
         dems,
         repubs)

# View the cleaned tibble
pac_final

# Continue from the cleaned pac_final dataset
pac_long <- pac_final |> 
  pivot_longer(
    cols = c(dems, repubs),
    names_to = "party",
    values_to = "amount"
  ) |> 
  mutate(
    party = case_when(
      party == "dems" ~ "Democrat",
      party == "repubs" ~ "Republican"
    )
  )
```

## 3 - Median housing prices in the US

## 4 - Expect More. Plot More.

## 5 - Mirror, mirror on the wall, whoâ€™s the ugliest of them all?
